{"version":3,"sources":["../src/sls.js"],"names":["SLS","config","backendSrv","url","mt","uri","hd","bd","fn","timeout","toUpperCase","api_version","Date","toGMTString","sortStr","getSortParamStr","signature","signFn","console","log","accessId","vurl","options","method","headers","datasourceRequest","ProjectName","logstore","opt","requestData","str","b64_hmac_sha1","accessKey","k","d","_p","_z","_f","t","b","c","_k","_s","x","y","l","m","_r","n","_c","w","a","e","i","length","o","p","q","r","s","j","_b","charCodeAt","_h","h","concat","_n","charAt","_x","obj","flag","APIVersion","push","encodeURIComponent","sort","join","hostname","replace","v","endpoint","host"],"mappings":"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","file":"sls.js","sourcesContent":["export class SLS{\n    constructor(config,backendSrv,url)\n    {\n        this.config = config;\n        this.backendSrv = backendSrv;\n        this.url = url;\n    }\n    requestData (mt, uri, hd, bd, fn, timeout) {\n        var config = this.config;\n\n        mt = mt.toUpperCase();\n\n        bd = bd || {};\n        hd['x-log-apiversion'] = config.api_version || '0.6.0';\n        hd['x-log-bodyrawsize'] = '0';\n        hd['x-log-signaturemethod'] = 'hmac-sha1';\n        hd['x-sls-date'] = new Date().toGMTString();\n\n\n        var sortStr = \"GET\\n\\n\\n\"+hd['x-sls-date']+\"\\nx-log-apiversion:\"+hd[\"x-log-apiversion\"]+\"\\nx-log-bodyrawsize:0\\nx-log-signaturemethod:hmac-sha1\\n\";\n        sortStr += uri+\"?\"+this.getSortParamStr(bd);\n\n        var signature = this.signFn(  sortStr);\n        console.log(sortStr);\n        console.log(signature);\n        hd['Authorization'] = 'LOG ' + config.accessId + \":\"+signature;\n\n        var url = uri + '?' + this.getSortParamStr(bd, true) ;\n\n        var vurl = this.url + url;\n        var options = {  url : vurl,\n                method:\"GET\",\n                headers: hd\n                };\n        console.log(\"options\",options);\n        return this.backendSrv.datasourceRequest(options\n                                );\n    }\n    GetData(ProjectName, logstore,opt, fn) {\n        opt[\"type\"] = \"log\";\n        return this.requestData('GET', '/logstores/'+logstore+\"/index\", {}, opt, fn);\n    }\n    signFn(str)\n    {\n        return this.b64_hmac_sha1(this.config.accessKey,str);\n    }\n    b64_hmac_sha1(k,d,_p,_z){\n        // heavily optimized and compressed version of http://pajhome.org.uk/crypt/md5/sha1.js\n        // _p = b64pad, _z = character size; not used here but I left them available just in case\n        if(!_p){_p='=';}if(!_z){_z=8;}function _f(t,b,c,d){if(t<20){return(b&c)|((~b)&d);}if(t<40){return b^c^d;}if(t<60){return(b&c)|(b&d)|(c&d);}return b^c^d;}function _k(t){return(t<20)?1518500249:(t<40)?1859775393:(t<60)?-1894007588:-899497514;}function _s(x,y){var l=(x&0xFFFF)+(y&0xFFFF),m=(x>>16)+(y>>16)+(l>>16);return(m<<16)|(l&0xFFFF);}function _r(n,c){return(n<<c)|(n>>>(32-c));}function _c(x,l){x[l>>5]|=0x80<<(24-l%32);x[((l+64>>9)<<4)+15]=l;var w=[80],a=1732584193,b=-271733879,c=-1732584194,d=271733878,e=-1009589776;for(var i=0;i<x.length;i+=16){var o=a,p=b,q=c,r=d,s=e;for(var j=0;j<80;j++){if(j<16){w[j]=x[i+j];}else{w[j]=_r(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);}var t=_s(_s(_r(a,5),_f(j,b,c,d)),_s(_s(e,w[j]),_k(j)));e=d;d=c;c=_r(b,30);b=a;a=t;}a=_s(a,o);b=_s(b,p);c=_s(c,q);d=_s(d,r);e=_s(e,s);}return[a,b,c,d,e];}function _b(s){var b=[],m=(1<<_z)-1;for(var i=0;i<s.length*_z;i+=_z){b[i>>5]|=(s.charCodeAt(i/8)&m)<<(32-_z-i%32);}return b;}function _h(k,d){var b=_b(k);if(b.length>16){b=_c(b,k.length*_z);}var p=[16],o=[16];for(var i=0;i<16;i++){p[i]=b[i]^0x36363636;o[i]=b[i]^0x5C5C5C5C;}var h=_c(p.concat(_b(d)),512+d.length*_z);return _c(o.concat(h),512+160);}function _n(b){var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",s='';for(var i=0;i<b.length*4;i+=3){var r=(((b[i>>2]>>8*(3-i%4))&0xFF)<<16)|(((b[i+1>>2]>>8*(3-(i+1)%4))&0xFF)<<8)|((b[i+2>>2]>>8*(3-(i+2)%4))&0xFF);for(var j=0;j<4;j++){if(i*8+j*6>b.length*32){s+=_p;}else{s+=t.charAt((r>>6*(3-j))&0x3F);}}}return s;}function _x(k,d){return _n(_h(k,d));}return _x(k,d);\n    }\n    getSortParamStr (obj, flag) {\n        var t = [];\n        if (flag) {\n            for (var k in obj) {\n                if (k=='protobuf'|| obj.APIVersion >= '0.3.0' && k == 'Project')continue;\n                t.push(k + '=' + encodeURIComponent(obj[k]));\n            }\n        }\n        else {\n            for (var k in obj) {\n                if (k=='protobuf' || obj.APIVersion >= '0.3.0' && k == 'Project')continue;\n                t.push(k + '=' + obj[k]);\n            }\n        }\n        t.sort();\n        return t.join('&');\n    }\n    getRealEndPoint (url, obj){\n\n        //test\n        //return {endpoint:  'http://service.sls-stg.aliyun-inc.com:179/', host: '44.sls-stg.aliyun-inc.com:179'};\n        var hostname = url.replace(\"http://\",\"\");\n        var v = url.replace(\"http://\",\"\");\n        return {endpoint:\"http://\"+obj[\"Project\"]+\".\"+v,host: hostname};\n    };\n\n}\n"]}